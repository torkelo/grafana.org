function metadata(e){var t=[];return file.walkSync(viewRoot,function(e,n,i){i.forEach(function(n){if(".DS_Store"!==n){var i,r=fs.readFileSync(e+"/"+n,"utf8"),o=/\/\*\!([\s\S]*)\!\*\//m,a=r.match(o),s=/\/\*\sDOC([\s\S]*?)\*\//m,c=r.match(s),l=/define\((\[[^\]]*\]),/,u=r.match(l);if(a&&a[1])try{i=JSON.parse(a[1])}catch(d){throw new Error("Error Parsing Metadata: "+n+"\nInput: `"+a[1]+"`")}else i={};var f=null;c&&c[1]&&(f=marked(c[1].trim())),i.doc=f;var p,h=[];if(!u||!u[1])throw new Error("Couldn't find the define for `"+n+"`");try{p=JSON.parse(u[1].replace(/'/g,'"'))}catch(d){throw new Error("Couldn't parse dependencies for `"+n+"`:\n`"+u[1]+"\n`")}p.forEach(function(e){"Modernizr"!==e&&h.push(e)}),i.deps=h;var m=__dirname.replace(/lib$/,"");i.path="./"+(e+"/"+n).replace(m,"").replace(/\\/g,"/"),i.amdPath=i.path.replace(/^\.\/feature\-detects/,"test").replace(/\.js$/i,""),i.name||(i.name=i.amdPath);var g=[];i.polyfills&&i.polyfills.length&&i.polyfills.forEach(function(e){if(!polyfills[e])throw new Error(i.name+": Polyfill not found in `"+n+"`: "+e);g.push(polyfills[e])}),i.polyfills=g,i.async||(i.async=!1),i.notes||(i.notes=[]),i.warnings||(i.warnings=[]),i.caniuse||(i.caniuse=null),!i.cssclass&&i.property?i.cssclass=i.property:i.cssclass=null,!i.doc&&i.docs&&(i.doc=i.docs,delete i.docs),i.tags||(i.tags=[]),i.authors||(i.authors=[]),i.knownBugs||(i.knownBugs=[]),t.push(i)}})}),e&&"function"==typeof e?e(t):t}var fs=require("fs"),file=require("file"),marked=require("marked"),polyfills=require("./polyfills.json"),viewRoot=fs.realpathSync(__dirname+"/../feature-detects");module.exports=metadata;